<%= render Admin::PageComponent.new(title: "Joueurs", icon: "users") do |page| %>
  <% page.with_actions do %>
    <%= button "Nouveau joueur",
          variant: :primary,
          href: new_admin_user_path,
          icon: :plus %>
  <% end %>

  <% page.with_toolbar do %>
    <%= render "filters" %>
  <% end %>

  <%= render Admin::TableComponent.new do %>
    <table class="min-w-full divide-y divide-gray-200 bg-white text-sm table-fixed">
    <thead class="bg-gray-50 text-gray-600 uppercase text-xs tracking-wide">
      <tr>
        <th scope="col" class="px-4 sm:px-6 py-3 text-left font-medium">
          <%= sortable_link_to "Nom", :name, preserve: { q: params[:q], gender: params[:gender], license_type: params[:license_type] } %>
        </th>
        <th scope="col" class="px-4 sm:px-6 py-3 text-left font-medium">Rôles</th>
        <th scope="col" class="px-4 sm:px-6 py-3 text-left font-medium">
          <%= sortable_link_to "Type de licence", :license_type, preserve: { q: params[:q], gender: params[:gender], license_type: params[:license_type] } %>
        </th>
        <th scope="col" class="px-4 sm:px-6 py-3 text-left font-medium">Groupe</th>
        <th scope="col" class="px-4 sm:px-6 py-3 text-right font-medium w-16 sm:w-24">Actions</th>
      </tr>
    </thead>
    <tbody class="divide-y divide-gray-100">
      <% @users.each do |user| %>
        <tr class="hover:bg-gray-50 transition-colors">
          <!-- Nom -->
          <td class="px-4 sm:px-6 py-4 whitespace-nowrap font-medium text-gray-800 flex items-center gap-2">
            <%= lucide_icon("user", size: 16, class: "text-gray-500") %>
            <%= "#{user.last_name} #{user.first_name}" %>
          </td>

          <!-- Email -->
          

          <!-- Rôles -->
          <td class="px-4 sm:px-6 py-4 space-x-1">
            <% if user.admin? %>
              <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-yellow-100 text-yellow-800 text-xs font-semibold">
                <%= lucide_icon("shield-user", size: 14) %> Admin
              </span>
            <% end %>
            <% if user.coach? %>
              <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-green-100 text-green-800 text-xs font-semibold">
                <%= lucide_icon("dumbbell", size: 14) %> Coach
              </span>
            <% end %>
            <% if user.responsable? %>
              <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-blue-100 text-blue-800 text-xs font-semibold">
                <%= lucide_icon("key-round", size: 14) %> Responsable
              </span>
            <% end %>
            <% if user.financial_manager? %>
              <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-purple-100 text-purple-800 text-xs font-semibold">
                <%= lucide_icon("wallet", size: 14) %> Resp. Financier
              </span>
            <% end %>
          </td>

          <!-- Type de licence -->
          <td class="px-4 sm:px-6 py-4">
            <% if user.license_type.present? %>
              <% if user.license_type == 'libre' %>
                <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-asmbv-red-light text-black text-xs font-semibold">
                  <%= lucide_icon("shield-half", size: 14) %> Libre
                </span>
              <% else %>
                <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-asmbv-red-light text-asmbv-red text-xs font-semibold">
                  <%= lucide_icon("trophy", size: 14) %> Compétition
                </span>
              <% end %>
            <% else %>
              <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-gray-100 text-gray-800 text-xs font-semibold">
                <%= lucide_icon("circle-off", size: 14) %> Pas de licence
              </span>
            <% end %>
          </td>

          <!-- Groupe -->
          <td class="px-4 sm:px-6 py-4">
            <% levels = user.levels.presence || [user.level].compact %>
            <% if levels.any? %>
              <%= levels.map { |l| l.respond_to?(:display_name) ? l.display_name : l.name }.join(', ') %>
            <% else %>
              –
            <% end %>
          </td>

          <!-- Actions -->
          <td class="px-4 sm:px-6 py-4">
            <div class="flex items-center justify-end gap-2">
              <%= button "Voir",
                    variant: :tertiary,
                    size: :small,
                    href: admin_user_path(user),
                    icon: :eye,
                    icon_only: true %>
              <%= button "Modifier",
                    variant: :tertiary,
                    size: :small,
                    href: edit_admin_user_path(user),
                    icon: :edit,
                    icon_only: true %>
            </div>
          </td>
        </tr>
      <% end %>
    </tbody>
    </table>
  <% end %>

  <%= render Admin::PaginationComponent.new(
        current_page: @current_page,
        total_pages: @total_pages,
        params: params
      ) %>
<% end %>
