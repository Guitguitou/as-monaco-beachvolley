<%= form_with model: [:admin, @user], class: "space-y-6 max-w-xl mx-auto bg-white p-6 rounded-lg shadow-md" do |f| %>
  <%= render "shared/form_errors", object: @user %>

  <!-- Nom / Prénom -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <div>
      <%= f.label :first_name, "Prénom", class: "block text-sm font-medium text-gray-900" %>
      <%= f.text_field :first_name,
            required: true,
            class: "mt-1 block w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-gray-900 
                    placeholder:text-gray-400 focus:border-asmbv-red focus:ring-2 focus:ring-asmbv-red sm:text-sm" %>
      <% if @user.errors[:first_name].any? %>
        <p class="mt-1 text-sm text-red-600"><%= @user.errors[:first_name].first %></p>
      <% end %>
    </div>

    <div>
      <%= f.label :last_name, "Nom", class: "block text-sm font-medium text-gray-900" %>
      <%= f.text_field :last_name,
            required: true,
            class: "mt-1 block w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-gray-900 
                    placeholder:text-gray-400 focus:border-asmbv-red focus:ring-2 focus:ring-asmbv-red sm:text-sm" %>
      <% if @user.errors[:last_name].any? %>
        <p class="mt-1 text-sm text-red-600"><%= @user.errors[:last_name].first %></p>
      <% end %>
    </div>
  </div>

  <!-- Email -->
  <div>
    <%= f.label :email, "Email", class: "block text-sm font-medium text-gray-900" %>
    <%= f.email_field :email,
          required: true,
          class: "mt-1 block w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-gray-900 
                  placeholder:text-gray-400 focus:border-asmbv-red focus:ring-2 focus:ring-asmbv-red sm:text-sm" %>
    <% if @user.errors[:email].any? %>
      <p class="mt-1 text-sm text-red-600"><%= @user.errors[:email].first %></p>
    <% end %>
  </div>

  <!-- Rôles -->
  <fieldset class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
    <div class="flex items-center">
      <%= f.check_box :admin, class: "h-4 w-4 text-asmbv-red border-gray-300 rounded focus:ring-asmbv-red" %>
      <%= f.label :admin, "Administrateur", class: "ml-2 text-sm text-gray-700" %>
    </div>

    <div class="flex items-center">
      <%= f.check_box :coach, class: "h-4 w-4 text-asmbv-red border-gray-300 rounded focus:ring-asmbv-red" %>
      <%= f.label :coach, "Coach", class: "ml-2 text-sm text-gray-700" %>
    </div>

    <div class="flex items-center">
      <%= f.check_box :responsable, class: "h-4 w-4 text-asmbv-red border-gray-300 rounded focus:ring-asmbv-red" %>
      <%= f.label :responsable, "Responsable", class: "ml-2 text-sm text-gray-700" %>
    </div>

    <div class="flex items-center">
      <%= f.check_box :financial_manager, class: "h-4 w-4 text-asmbv-red border-gray-300 rounded focus:ring-asmbv-red" %>
      <%= f.label :financial_manager, "Responsable financier", class: "ml-2 text-sm text-gray-700" %>
    </div>
  </fieldset>

  <!-- Activation du compte -->
  <div class="border-l-4 border-asmbv-red bg-asmbv-red/5 p-4 rounded">
    <div class="flex items-start">
      <div class="flex items-center h-5">
        <%= f.check_box :activate_immediately,
              { checked: @user.persisted? ? @user.activated? : false, class: "h-4 w-4 text-asmbv-red border-gray-300 rounded focus:ring-asmbv-red" },
              "1", "0" %>
      </div>
      <div class="ml-3">
        <%= f.label :activate_immediately, class: "text-sm font-medium text-gray-900" do %>
          Activer le compte immédiatement
        <% end %>
        <p class="text-xs text-gray-600 mt-1">
          ⚠️ Par défaut, le compte sera inactif jusqu'au paiement de la licence.
          <% if @user.new_record? %>
            Cochez cette case pour activer le compte dès sa création.
          <% else %>
            <%= @user.activated? ? "✅ Compte activé le #{l(@user.activated_at, format: :short)}" : "❌ Compte non activé" %>
          <% end %>
        </p>
      </div>
    </div>
  </div>

  <!-- Niveaux (multi) -->
  <div>
    <%= f.label :level_ids, "Niveaux", class: "block text-sm font-medium text-gray-900" %>
    <div class="mt-2 grid grid-cols-1 sm:grid-cols-2 gap-2">
      <%= f.collection_check_boxes :level_ids, Level.all, :id, :name do |b| %>
        <label class="flex items-center gap-2">
          <%= b.check_box(class: "h-4 w-4 text-asmbv-red border-gray-300 rounded focus:ring-asmbv-red") %>
          <span class="text-sm text-gray-700"><%= b.text %></span>
        </label>
      <% end %>
    </div>
  </div>

  <!-- Type de licence -->
  <div class="max-w-xs">
    <%= f.label :license_type, "Type de licence", class: "block text-sm font-medium text-gray-900" %>
    <%= f.select :license_type,
          options_for_select([["—", nil], ["Libre", "libre"], ["Compétition", "competition"]], @user.license_type),
          {},
          class: "mt-1 block w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-gray-900 focus:border-asmbv-red focus:ring-2 focus:ring-asmbv-red sm:text-sm" %>
    <% if @user.errors[:license_type].any? %>
      <p class="mt-1 text-sm text-red-600"><%= @user.errors[:license_type].first %></p>
    <% end %>
  </div>

  <!-- Rémunération (coach) -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <div>
      <%= f.label :salary_per_training, "Rémunération par entraînement (€)", class: "block text-sm font-medium text-gray-900" %>
      <%= f.number_field :salary_per_training, step: 1, min: 0,
            class: "mt-1 block w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-gray-900 placeholder:text-gray-400 focus:border-asmbv-red focus:ring-2 focus:ring-asmbv-red sm:text-sm" %>
      <p class="text-xs text-gray-500 mt-1">Applicable si l’utilisateur est coach.</p>
      <% if @user.errors[:salary_per_training_cents].any? %>
        <p class="mt-1 text-sm text-red-600"><%= @user.errors[:salary_per_training_cents].first %></p>
      <% end %>
    </div>
  </div>

  <!-- Mot de passe (optionnel à la création / modification) -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <div>
      <%= f.label :password, "Mot de passe", class: "block text-sm font-medium text-gray-900" %>
      <%= f.password_field :password, autocomplete: "new-password",
            class: "mt-1 block w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-gray-900 placeholder:text-gray-400 focus:border-asmbv-red focus:ring-2 focus:ring-asmbv-red sm:text-sm" %>
      <% if @user.errors[:password].any? %>
        <p class="mt-1 text-sm text-red-600"><%= @user.errors[:password].first %></p>
      <% end %>
    </div>
    <div>
      <%= f.label :password_confirmation, "Confirmation", class: "block text-sm font-medium text-gray-900" %>
      <%= f.password_field :password_confirmation, autocomplete: "new-password",
            class: "mt-1 block w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-gray-900 placeholder:text-gray-400 focus:border-asmbv-red focus:ring-2 focus:ring-asmbv-red sm:text-sm" %>
      <% if @user.errors[:password_confirmation].any? %>
        <p class="mt-1 text-sm text-red-600"><%= @user.errors[:password_confirmation].first %></p>
      <% end %>
    </div>
  </div>

  <!-- Bouton -->
  <div>
    <%= f.submit class: "w-full inline-flex justify-center items-center gap-x-1.5 rounded-md bg-asmbv-red px-4 py-2 
                        text-sm font-semibold text-white shadow-sm hover:bg-asmbv-red-dark 
                        focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 
                        focus-visible:outline-asmbv-red transition-colors" do %>
      <%= lucide_icon("save", size: 16) %> Enregistrer
    <% end %>
  </div>
<% end %>
