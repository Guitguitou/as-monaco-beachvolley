<div class="flex items-center justify-between mb-6 flex-col gap-3 sm:flex-row sm:gap-0">
  <h1 class="text-2xl font-bold flex items-center gap-2 text-gray-900">
    <%= lucide_icon("credit-card") %> Acheter des crédits
  </h1>
</div>

<%# Solde actuel %>
<div class="bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl shadow-lg p-6 mb-8 text-white">
  <div class="flex items-center gap-4">
    <div class="p-4 bg-white/20 rounded-lg">
      <%= lucide_icon("wallet", size: 32) %>
    </div>
    <div>
      <p class="text-sm uppercase tracking-wide opacity-90">Solde actuel</p>
      <p class="text-4xl font-bold"><%= @current_balance %> <span class="text-xl font-normal">crédits</span></p>
    </div>
  </div>
</div>

<%# Pack 10 EUR %>
<div class="bg-white rounded-xl border border-gray-200 shadow-sm max-w-md mx-auto">
  <div class="bg-gradient-to-br from-asmbv-red to-asmbv-red-dark p-8 text-white rounded-t-xl">
    <div class="flex items-center justify-between mb-4">
      <div>
        <h3 class="text-2xl font-bold">Pack Standard</h3>
        <p class="text-sm opacity-90 mt-1">Le pack parfait pour démarrer</p>
      </div>
      <%= lucide_icon("package", size: 40, class: "opacity-50") %>
    </div>
    <div class="flex items-baseline gap-2">
      <span class="text-5xl font-bold">10</span>
      <span class="text-2xl">€</span>
    </div>
  </div>

  <div class="p-8">
    <div class="flex items-center justify-between mb-6 pb-6 border-b border-gray-200">
      <div class="flex items-center gap-2 text-gray-700">
        <%= lucide_icon("coins", size: 24, class: "text-asmbv-red") %>
        <span class="text-lg font-medium">Vous recevez</span>
      </div>
      <span class="text-3xl font-bold text-asmbv-red">1000 crédits</span>
    </div>

    <div class="space-y-3 mb-6">
      <div class="flex items-center gap-2 text-sm text-gray-600">
        <%= lucide_icon("check-circle", size: 16, class: "text-green-600") %>
        <span>100 crédits = 1 €</span>
      </div>
      <div class="flex items-center gap-2 text-sm text-gray-600">
        <%= lucide_icon("check-circle", size: 16, class: "text-green-600") %>
        <span>Paiement sécurisé</span>
      </div>
      <div class="flex items-center gap-2 text-sm text-gray-600">
        <%= lucide_icon("check-circle", size: 16, class: "text-green-600") %>
        <span>Crédits ajoutés instantanément</span>
      </div>
    </div>

    <%= button_to buy_10_eur_admin_payments_path,
          method: :post,
          class: "w-full inline-flex items-center justify-center gap-2 rounded-lg bg-asmbv-red px-6 py-4 text-lg font-semibold text-white shadow-sm hover:bg-asmbv-red-dark focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-asmbv-red transition-all",
          data: { turbo: false } do %>
      <%= lucide_icon("shopping-cart", size: 20) %>
      Acheter maintenant
    <% end %>
  </div>
</div>

<%# Historique des achats %>
<% if @credit_purchases.any? %>
  <div class="mt-8">
    <h2 class="text-xl font-bold flex items-center gap-2 text-gray-900 mb-4">
      <%= lucide_icon("history") %> Mes derniers achats
    </h2>

    <div class="overflow-x-auto rounded-xl border border-gray-200 shadow-sm">
      <table class="min-w-full divide-y divide-gray-200 bg-white text-sm table-fixed">
        <thead class="bg-gray-50 text-gray-600 uppercase text-xs tracking-wide">
          <tr>
            <th class="px-4 sm:px-6 py-3 text-left">Date</th>
            <th class="px-4 sm:px-6 py-3 text-left hidden sm:table-cell">Référence</th>
            <th class="px-4 sm:px-6 py-3 text-left">Montant</th>
            <th class="px-4 sm:px-6 py-3 text-left hidden md:table-cell">Crédits</th>
            <th class="px-4 sm:px-6 py-3 text-left">Statut</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-100">
          <% @credit_purchases.each do |purchase| %>
            <tr class="hover:bg-gray-50 transition-colors">
              <td class="px-4 sm:px-6 py-4 text-gray-700">
                <%= l(purchase.created_at, format: :short) %>
              </td>
              <td class="px-4 sm:px-6 py-4 text-xs font-mono text-gray-500 hidden sm:table-cell">
                <%= purchase.sherlock_transaction_reference %>
              </td>
              <td class="px-4 sm:px-6 py-4 font-semibold text-gray-900">
                <%= number_to_currency(purchase.amount_eur, unit: "€", precision: 2) %>
              </td>
              <td class="px-4 sm:px-6 py-4 text-gray-700 hidden md:table-cell">
                <%= purchase.credits %>
              </td>
              <td class="px-4 sm:px-6 py-4">
                <% case purchase.status %>
                <% when "paid" %>
                  <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-green-100 text-green-800 text-xs font-semibold">
                    <%= lucide_icon("check-circle", size: 14) %> Payé
                  </span>
                <% when "pending" %>
                  <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-yellow-100 text-yellow-800 text-xs font-semibold">
                    <%= lucide_icon("clock", size: 14) %> En attente
                  </span>
                <% when "failed" %>
                  <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-red-100 text-red-800 text-xs font-semibold">
                    <%= lucide_icon("x-circle", size: 14) %> Échoué
                  </span>
                <% when "cancelled" %>
                  <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-gray-100 text-gray-800 text-xs font-semibold">
                    <%= lucide_icon("ban", size: 14) %> Annulé
                  </span>
                <% end %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
<% end %>
