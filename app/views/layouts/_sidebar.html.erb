<!-- Nouveau layout application.html.erb adapté au layout admin -->
<aside
  class="fixed z-50 inset-y-0 left-0 w-48 bg-white border-r border-gray-200 transform -translate-x-full transition-transform duration-200 ease-in-out lg:translate-x-0 lg:static lg:z-auto lg:block"
  data-admin-sidebar-target="sidebar"
  data-sidebar-target="sidebar"
>
  <div class="flex justify-end lg:hidden">
    <button data-action="click->sidebar#toggle" class="p-2 text-asmbv-red">
      <%= lucide_icon("x", class: "w-5 h-5") %>
    </button>
  </div>
  <div class="p-4 flex flex-col h-full space-y-6">
    <div class="flex items-center gap-2 text-asmbv-red text-xl font-semibold justify-center">
      <%= link_to (current_user.activated? ? root_path : packs_path) do %>
        <%= image_tag "logo.png", class: "w-16 h-16 md:w-20 md:h-20" %>
      <% end %>
    </div>

    <nav class="flex-1 space-y-2 text-xs">
      <% if current_user.activated? %>
        <%= nav_link "Performances & Stats", performances_path, icon: "bar-chart-3", extra_classes: 'sidebar-link' %>
        <%= nav_link "Calendrier", sessions_path, icon: "calendar", extra_classes: 'sidebar-link' %>
        <%= nav_link "Stages", stages_path, icon: "flag", extra_classes: 'sidebar-link' %>
        <%= nav_link "Mes sessions", me_sessions_path, icon: "volleyball", extra_classes: 'sidebar-link' %>
        <%= nav_link "Packs", packs_path, icon: "credit-card", extra_classes: 'sidebar-link' %>
        <% if current_user.coach? || current_user.admin? %>
          <%= nav_link "Entraînements (coach)", coach_trainings_path, icon: "book-open", extra_classes: 'sidebar-link' %>
        <% end %>
        <%= nav_link "Mon profil", profile_path, icon: "user", extra_classes: 'sidebar-link' %>
      <% else %>
        <!-- Sidebar limitée pour comptes non activés -->
        <%= nav_link "Packs", packs_path, icon: "credit-card", extra_classes: 'sidebar-link' %>
        <%= nav_link "Stages", stages_path, icon: "flag", extra_classes: 'sidebar-link' %>
        <%= nav_link "Mon profil", profile_path, icon: "user", extra_classes: 'sidebar-link' %>
      <% end %>

      <div class="pt-2" data-controller="collapse" data-open="false">
        <button type="button" data-action="click->collapse#toggle" class="w-full flex items-center gap-2 px-3 py-2 rounded-md hover:bg-gray-100 text-gray-800 font-medium text-sm sidebar-link">
          <span>Règles & informations</span>
          <span class="ml-auto text-gray-500 transition-transform" data-collapse-target="chevron">
            <%= lucide_icon 'chevron-down', class: '' %>
          </span>
        </button>
        <div class="space-y-1 pl-6 mt-1" data-collapse-target="content" class="hidden">
          <%= nav_link "Vidéos tutos", infos_videos_path, icon: "play", extra_classes: 'sidebar-link' %>
          <%= nav_link "Planning des entraînements", infos_planning_trainings_path, icon: "calendar-days", extra_classes: 'sidebar-link' %>
          <%= nav_link "Planning de la saison", infos_planning_season_path, icon: "calendar-range", extra_classes: 'sidebar-link' %>
          <%= nav_link "Règlement intérieur", infos_internal_rules_path, icon: "file-text", extra_classes: 'sidebar-link' %>
          <%= nav_link "Responsables réservations", infos_reservations_leads_path, icon: "users", extra_classes: 'sidebar-link' %>
          <%= nav_link "Plaquette de présentation", infos_brochure_path, icon: "book-open", extra_classes: 'sidebar-link' %>
          <%= nav_link "Règles d'inscription", infos_registration_rules_path, icon: "scale", extra_classes: 'sidebar-link' %>
        </div>
      </div>

      <% if current_user.admin? || current_user.financial_manager? %>
        <%= nav_link "Admin", admin_root_path, icon: "shield-check" %>
      <% end %>
    </nav>

    <div class="border-t border-gray-200 pt-4 mt-auto space-y-2">
      <% if user_signed_in? && vapid_public_key.present? %>
        <button type="button" 
                data-action="click->push-notifications#requestPermission"
                data-push-notifications-target="enableButton"
                class="w-full flex items-center gap-2 px-3 py-2 rounded-md hover:bg-gray-100 text-gray-800 font-medium text-sm"
                style="display: none;">
          <%= lucide_icon('bell', class: 'w-5 h-5 text-asmbv-red') %>
          <span>Activer les notifications</span>
        </button>
      <% end %>
      <%= link_to destroy_user_session_path,
            data: { turbo_method: :delete },
            class: "flex items-center gap-2 px-3 py-2 rounded-md hover:bg-gray-100 text-gray-800 font-medium" do %>
        <%= lucide_icon('log-out', class: 'w-5 h-5 text-asmbv-red') %>
        <span>Déconnexion</span>
      <% end %>
    </div>
  </div>
</aside>
