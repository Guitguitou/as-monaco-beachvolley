<div class="mb-4">
  <!-- Titre -->
  <div class="flex flex-col items-center sm:flex-row sm:items-center sm:justify-between gap-4 mb-4 text-center sm:text-left">
    <h1 class="text-2xl font-bold flex items-center gap-2 justify-center">
      <%= lucide_icon("calendar") %> Mon calendrier
    </h1>
    
    <% if can?(:create, Session) %>
      <%= link_to new_session_path, class: "bg-asmbv-red hover:bg-asmbv-red-dark text-asmbv-red-light font-semibold rounded-md px-4 py-2 transition inline-flex items-center gap-2 w-full sm:w-auto justify-center" do %>
        <%= lucide_icon("plus-circle", class: "w-5 h-5") %> Nouvelle session
      <% end %>
    <% end %>
  </div>
  
  <!-- Filtres de terrain -->
  <%= render "terrain_filter" %>
</div>

<%
  sessions_json = @sessions.map do |s|
    bg, border, text = case s.terrain
    when 'Terrain 1'
      ['#ef4444', '#b91c1c', '#ffffff'] # red
    when 'Terrain 2'
      ['#111827', '#0b1220', '#ffffff'] # black
    when 'Terrain 3'
      ['#D4AF37', '#b08e2d', '#111827'] # gold
    else
      ['#e5e7eb', '#d1d5db', '#111827'] # gray fallback
    end

    {
      id: s.id,
      title: "#{s.display_name} - #{s.user&.full_name || '-'}",
      start: s.start_at.iso8601,
      end: s.end_at.iso8601,
      url: session_path(s),
      backgroundColor: bg,
      borderColor: border,
      textColor: text,
      terrain: s.terrain
    }
  end.to_json
%>

<div
  id="calendar"
  data-controller="calendar"
  data-sessions="<%= json_escape(sessions_json) %>"
  class="mt-4 bg-white p-2 sm:p-4 min-h-[60vh] rounded-md overflow-hidden">
</div>
