
<% if session.errors.any? %>
  <div class="fr-alert fr-alert--error mb-4">
    <h3 class="fr-alert__title">Erreurs de validation</h3>
    <ul class="fr-alert__details">
      <% session.errors.full_messages.each do |message| %>
        <li><%= message %></li>
      <% end %>
    </ul>
  </div>
<% end %>

<%= form_with model: session, url: session.persisted? ? session_path(session) : sessions_path, method: session.persisted? ? :put : :post, data: { controller: "session-form" } do |f| %>
  <div class="fr-input-group">
    <%= f.label :title, class: "fr-label" %>
    <%= f.text_field :title, class: "fr-input", required: true %>
  </div>

  <div class="fr-input-group">
    <%= f.label :description, class: "fr-label" %>
    <%= f.text_area :description, class: "fr-input" %>
  </div>

  <div class="fr-input-group">
    <%= f.label :session_type, "Type de session", class: "fr-label" %>
    <%= f.select :session_type, options_for_select(Session.session_types.keys.map { |t| [t.humanize, t] }), {}, class: "fr-select", data: { session_form_target: "type", action: "session-form#updateUserSelect" } %>
  </div>

  <div class="fr-input-group">
    <%= f.label :terrain, "Terrain", class: "fr-label" %>
    <%= f.select :terrain, options_for_select(Session.terrains.keys.map { |t| ["Terrain #{t.to_s.split('_').last}", t] }), {}, class: "fr-select" %>
  </div>

  <div class="fr-input-group hidden" data-session-form-target="userGroupCoach">
    <%= f.label :user_id, "Coach", class: "fr-label" %>
    <%= f.select :user_id, options_from_collection_for_select(User.coachs, :id, :full_name), {}, class: "fr-select" %>
  </div>

  <div class="fr-input-group hidden" data-session-form-target="userGroupResponsable">
    <%= f.label :user_id, "Responsable", class: "fr-label" %>
    <%= f.select :user_id, options_from_collection_for_select(User.responsables, :id, :full_name), {}, class: "fr-select" %>
  </div>

  <div class="fr-input-group hidden" data-session-form-target="userGroupAll">
    <%= f.label :user_id, "Organisateur", class: "fr-label" %>
    <%= f.select :user_id, options_from_collection_for_select(User.all, :id, :full_name), {}, class: "fr-select" %>
  </div>

  <div class="fr-input-group">
    <%= f.label :start_at, class: "fr-label" %>
    <%= f.datetime_local_field :start_at, class: "fr-input" %>
  </div>

  <div class="fr-input-group">
    <%= f.label :end_at, class: "fr-label" %>
    <%= f.datetime_local_field :end_at, class: "fr-input" %>
  </div>

  <div class="fr-input-group">
    <%= f.label :max_players, class: "fr-label" %>
    <%= f.number_field :max_players, class: "fr-input" %>
  </div>

  <div class="fr-input-group">
    <%= f.label :level_ids, "Niveaux", class: "fr-label" %>
    <div class="fr-checkbox-group flex flex-col gap-2">
      <%= f.collection_check_boxes :level_ids, (@levels || Level.all), :id, :name do |b| %>
        <div class="fr-checkbox">
          <%= b.check_box(class: "fr-checkbox__input") %>
          <%= b.label(class: "fr-checkbox__label") do %>
            <%= "#{b.object.name} - #{b.object.gender.humanize}" %>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>

  <%= f.submit class: "fr-btn bg-asmbv-red hover:bg-asmbv-red-dark text-white" do %>
    <%= lucide_icon("save", size: 16) %> Enregistrer
  <% end %>
<% end %>
